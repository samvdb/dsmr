---
substitutions:
  device_name: slimmelezer
  base_topic: homeassistant/slimmelezer

esphome:
  name: ${device_name}
  name_add_mac_suffix: false
  project:
    name: zuidwijk.slimmelezer
    version: "2.0"

esp8266:
  restore_from_flash: true
  board: d1_mini

wifi:
  # remove leading '#' and fill in your wifi details !!
  ssid: !secret wifi_ssid 
  password: !secret wifi_password

  # Enable fallback hotspot (captive portal) in case wifi connection fails
  ap:
    ssid: ${device_name}
  
  # Powersaving for brownout due to 250mA restriction P1
  output_power: 14dB

captive_portal:

# Enable logging
logger:
  baud_rate: 0
#  logs: 
#    component: ERROR


ota:
  platform: esphome

dashboard_import:
  package_import_url: github://zuidwijk/dsmr/slimmelezer.yaml@main
  import_full_config: true

api:

web_server:
  port: 80
  
uart:
  id: uart_bus
  rx_pin: D7
  baud_rate: 115200
  parity: NONE
  data_bits: 8
  stop_bits: 1
  rx_buffer_size: 1500  

external_components:
  - source:
      type: git
      url: https://github.com/mmakaay/esphome
      ref: fix-dsmr-read-chunk-size
    components: [ "dsmr" ]
    refresh: 60s
  - source: github://oxan/esphome-stream-server

stream_server:
   uart_id: uart_bus
   port: 1234


binary_sensor:
  - platform: stream_server
    connected:
      name: Connected
sensor:
  - platform: stream_server
    connection_count:
      name: Number of connections

  - platform: uptime
    name: "SlimmeLezer Uptime"
  - platform: wifi_signal
    name: "SlimmeLezer Wi-Fi Signal"
    update_interval: 60s



text_sensor:
- platform: wifi_info
  ip_address:
    name: "SlimmeLezer IP Address"
  ssid:
    name: "SlimmeLezer Wi-Fi SSID"
  bssid:
    name: "SlimmeLezer Wi-Fi BSSID"
- platform: version
  name: "ESPHome Version"
  hide_timestamp: true


